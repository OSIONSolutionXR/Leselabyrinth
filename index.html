<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OSION Solution XR – Leselabyrinth (1-Datei MVP)</title>
  <style>
    :root{
      --bg1:#070a18; --bg2:#241055; --bg3:#43114a;
      --card: rgba(255,255,255,.07);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --pink:#ff3fa9; --violet:#7b4dff; --cyan:#2ee3ff; --lime:#7CFF5C; --gold:#ffd24d;
      --ok:#28d17c; --bad:#ff4b6e; --warn:#ffb84d;
      --shadow: 0 22px 70px rgba(0,0,0,.38);
      --r:18px; --r2:26px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 20%, rgba(123,77,255,.35), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(255,63,169,.25), transparent 55%),
        radial-gradient(1000px 700px at 40% 90%, rgba(46,227,255,.20), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 55%, var(--bg3));
      overflow-x:hidden;
    }
    body:before{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image: radial-gradient(rgba(255,255,255,.12) 1px, transparent 1px);
      background-size: 38px 38px; opacity:.18;
    }

    .topbar{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:14px 18px;
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.06));
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .brand .t{font-weight:1000; font-size:15px; color:var(--pink); letter-spacing:.3px}
    .brand .s{font-size:12px; color:var(--muted)}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px; border-radius:999px;
      font-weight:1000; cursor:pointer;
      transition:.15s transform,.2s background,.2s border-color;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.20)}
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,63,169,.95), rgba(123,77,255,.95));
      box-shadow: 0 12px 28px rgba(255,63,169,.18);
    }
    .btn.danger{ background: rgba(255,75,110,.10); border-color: rgba(255,75,110,.25); }

    .wrap{ max-width: 1180px; margin: 18px auto 44px; padding: 0 16px; display:grid; grid-template-columns: 1fr; gap:14px; }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .miniBar{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      padding: 10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
    }
    .pill{
      display:flex; gap:8px; align-items:center;
      padding: 7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-weight:1000; font-size:12px;
      user-select:none;
    }
    .pill b{opacity:.75}
    .pill.right{margin-left:auto}
    .badgeGold{border-color: rgba(255,210,77,.26); background: rgba(255,210,77,.10)}
    .badgePink{border-color: rgba(255,63,169,.26); background: rgba(255,63,169,.10)}
    .badgeCyan{border-color: rgba(46,227,255,.24); background: rgba(46,227,255,.09)}
    .badgeLime{border-color: rgba(124,255,92,.22); background: rgba(124,255,92,.08)}

    .guide{
      display:flex; align-items:center; gap:12px;
      padding: 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: linear-gradient(90deg, rgba(255,210,77,.14), rgba(46,227,255,.08), rgba(255,63,169,.08));
    }
    .avatar{
      width:44px; height:44px; border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: radial-gradient(circle at 30% 30%, rgba(255,210,77,.38), rgba(123,77,255,.22));
      display:flex; align-items:center; justify-content:center;
      font-weight:1000;
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
    }
    .gtext{display:flex; flex-direction:column; gap:4px; min-width:0}
    .gtext .who{font-weight:1000; font-size:13px}
    .gtext .msg{font-weight:1000; font-size:13px; color:rgba(255,255,255,.86); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .content{
      padding: 14px;
      display:grid;
      gap: 12px;
      grid-template-columns: 1.2fr .8fr;
      align-items:start;
    }
    @media (max-width: 980px){ .content{grid-template-columns:1fr} }

    /* ===== Scene (heller + RPG Feel) ===== */
    .sceneBox{
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 380px at 20% 20%, rgba(46,227,255,.22), transparent 55%),
        radial-gradient(900px 420px at 85% 40%, rgba(255,210,77,.18), transparent 60%),
        radial-gradient(900px 420px at 60% 80%, rgba(124,255,92,.10), transparent 60%),
        rgba(255,255,255,.04);
      overflow:hidden;
      position:relative;
      min-height: 320px;
    }

    .sceneHint{
      position:absolute; top:10px; right:10px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      font-weight:1000; font-size:12px;
      color: rgba(255,255,255,.86);
      user-select:none;
    }

    /* Mini tooltip */
    .tooltip{
      position:absolute;
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      font-weight:1000;
      font-size: 12px;
      color: rgba(255,255,255,.92);
      pointer-events:none;
      opacity:0;
      transform: translateY(6px);
      transition:.15s opacity,.15s transform;
      z-index:10;
      max-width: 220px;
    }
    .tooltip.show{ opacity:1; transform: translateY(0); }

    /* FIPS sprite (stilisiert) */
    .fips{
      position:absolute; left: 18px; bottom: 16px;
      width: 120px; height: 140px;
      display:flex; align-items:flex-end; justify-content:center;
      pointer-events:none;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.35));
    }

    /* Pergament Questlog */
    .questlog{
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(700px 220px at 30% 30%, rgba(255,210,77,.20), transparent 60%),
        radial-gradient(700px 240px at 70% 40%, rgba(255,63,169,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,244,214,.12), rgba(255,255,255,.05));
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .questlog:before{
      content:"";
      position:absolute; inset:-20%;
      background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,.20), transparent 60%);
      transform: translateX(-40%) rotate(10deg);
      animation: shine 3.2s ease-in-out infinite;
      opacity:.55;
      pointer-events:none;
    }
    @keyframes shine{
      0%{ transform: translateX(-60%) rotate(10deg); opacity:.0; }
      20%{ opacity:.55; }
      55%{ transform: translateX(20%) rotate(10deg); opacity:.35; }
      100%{ transform: translateX(60%) rotate(10deg); opacity:0; }
    }

    .qhdr{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .qhdr .title{font-weight:1000; font-size:14px}
    .qhdr .tag{
      font-size:12px; font-weight:1000;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
      color: rgba(255,255,255,.86);
      user-select:none;
    }

    .readText{
      margin-top: 10px;
      font-weight:1000;
      font-size: 26px;
      line-height: 1.35;
      color: rgba(255,255,255,.96);
    }
    .readText .hl{
      padding: 0 .18em;
      border-radius: .35em;
      background: rgba(255,210,77,.20);
      border: 1px solid rgba(255,210,77,.20);
      box-shadow: 0 10px 24px rgba(255,210,77,.08);
    }

    .question{
      margin-top: 12px;
      font-weight:1000;
      font-size: 20px;
      color: rgba(255,255,255,.96);
    }

    .answers{ display:grid; gap:10px; margin-top: 10px; }

    .ans{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      padding: 14px 14px;
      font-size: 18px;
      font-weight:1000;
      background:
        radial-gradient(700px 140px at 20% 20%, rgba(46,227,255,.12), transparent 55%),
        radial-gradient(700px 160px at 80% 40%, rgba(255,63,169,.10), transparent 60%),
        rgba(255,255,255,.06);
      cursor:pointer;
      transition:.15s transform,.2s background,.2s border-color,.2s box-shadow;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .ans:before{
      content:"";
      position:absolute; inset:-40%;
      background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,.18), transparent 60%);
      transform: translateX(-40%) rotate(12deg);
      animation: shine 2.6s ease-in-out infinite;
      opacity:.45;
      pointer-events:none;
    }
    .ans:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
      background:
        radial-gradient(700px 140px at 20% 20%, rgba(124,255,92,.14), transparent 55%),
        radial-gradient(700px 160px at 80% 40%, rgba(255,210,77,.12), transparent 60%),
        rgba(255,255,255,.07);
    }
    .ans.correct{
      border-color: rgba(40,209,124,.38);
      background:
        radial-gradient(700px 140px at 20% 20%, rgba(40,209,124,.22), transparent 55%),
        radial-gradient(700px 160px at 80% 40%, rgba(255,210,77,.14), transparent 60%),
        rgba(40,209,124,.08);
    }
    .ans.wrong{
      border-color: rgba(255,75,110,.45);
      background:
        radial-gradient(700px 140px at 20% 20%, rgba(255,75,110,.22), transparent 55%),
        radial-gradient(700px 160px at 80% 40%, rgba(123,77,255,.12), transparent 60%),
        rgba(255,75,110,.07);
    }

    .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top: 10px; }
    .mini{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      font-weight:1000;
      cursor:pointer;
      transition:.15s transform,.2s background;
      user-select:none;
    }
    .mini:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }

    .statusLine{
      margin-top: 10px;
      border-radius: 16px;
      border:1px dashed rgba(255,255,255,.16);
      padding: 12px 12px;
      background: rgba(0,0,0,.12);
      font-weight: 1000;
      font-size: 13px;
      line-height: 1.3;
      color: rgba(255,255,255,.86);
    }
    .statusLine.good{ border-color: rgba(40,209,124,.35); background: rgba(40,209,124,.08); }
    .statusLine.bad{ border-color: rgba(255,75,110,.40); background: rgba(255,75,110,.08); }
    .statusLine.neutral{ border-color: rgba(255,210,77,.30); background: rgba(255,210,77,.06); }

    /* Reward Overlay */
    .reward{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      z-index:200; pointer-events:none;
      background: radial-gradient(820px 620px at 50% 45%, rgba(255,210,77,.20), rgba(0,0,0,.72));
    }
    .reward.show{ display:flex; }
    .starWrap{
      width:min(540px, 84vw);
      aspect-ratio:1/1;
      position:relative;
      filter: drop-shadow(0 30px 60px rgba(0,0,0,.45));
      animation: pop .55s cubic-bezier(.18,1.2,.3,1) forwards;
    }
    @keyframes pop{
      0%{ transform: scale(.40) rotate(-18deg); opacity:0; }
      70%{ transform: scale(1.06) rotate(6deg); opacity:1; }
      100%{ transform: scale(1) rotate(0deg); opacity:1; }
    }
    .spark{
      position:absolute; inset:-15%;
      border-radius:999px;
      background: conic-gradient(from 0deg,
        rgba(255,210,77,.0),
        rgba(255,210,77,.38),
        rgba(46,227,255,.28),
        rgba(255,63,169,.26),
        rgba(124,255,92,.22),
        rgba(255,210,77,.0)
      );
      animation: spin 1.2s linear infinite;
      filter: blur(1px);
      opacity:.95;
    }
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .rewardText{
      position:absolute;
      bottom:-10px; left:50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      padding: 10px 14px;
      border-radius:999px;
      font-weight:1000;
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }

    /* Tiny floating particles (CSS only) */
    .particle{
      position:absolute;
      width: 6px; height: 6px;
      border-radius: 999px;
      background: rgba(255,210,77,.75);
      filter: blur(.2px);
      opacity:.0;
      animation: drift 4.4s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{
      0%{ transform: translate(0,0) scale(.6); opacity:0; }
      10%{ opacity:.7; }
      60%{ opacity:.55; }
      100%{ transform: translate(40px,-120px) scale(1.2); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <div class="t">OSION Solution XR</div>
      <div class="s">Leselabyrinth • 1-Datei MVP • Funkelwald Quest-Screen</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button class="btn primary" id="btnPlay" type="button">Play</button>
      <button class="btn danger" id="btnReset" type="button">Reset</button>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="miniBar">
        <div class="pill badgeGold"><b>Sterne</b> <span id="kStars">0</span></div>
        <div class="pill badgePink"><b>Serie</b> <span id="kStreak">0</span></div>
        <div class="pill badgeCyan"><b>Stufe</b> <span id="kLevel">1</span></div>
        <div class="pill badgeLime"><b>Fokus</b> <span id="kFocus">Ursache/Wirkung</span></div>
        <div class="pill right"><b>Quest</b> <span id="kQuest">Boss-Tor</span></div>
      </div>

      <div class="guide">
        <div class="avatar">F</div>
        <div class="gtext">
          <div class="who" id="gName">Fips der Funkenkobold</div>
          <div class="msg" id="gMsg">Tippe in die Szene. Sammle Geheimfunken. Dann Quest lösen.</div>
        </div>
      </div>

      <div class="content">
        <!-- SCENE -->
        <div class="sceneBox" id="scene">
          <div class="sceneHint" id="sceneHint">Tippe ins Bild: Dinge entdecken</div>
          <div class="tooltip" id="tip"></div>

          <!-- stylisierte Szene als SVG (hell, klar) -->
          <svg viewBox="0 0 900 420" width="100%" height="320" style="display:block;">
            <defs>
              <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="rgba(46,227,255,.30)"/>
                <stop offset="100%" stop-color="rgba(123,77,255,.18)"/>
              </linearGradient>
              <linearGradient id="ground" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="rgba(124,255,92,.22)"/>
                <stop offset="100%" stop-color="rgba(0,0,0,.08)"/>
              </linearGradient>
              <filter id="glow" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="7" result="b"/>
                <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
            </defs>

            <rect x="0" y="0" width="900" height="420" fill="url(#sky)"/>

            <!-- funkeln -->
            <g opacity=".9">
              <circle cx="120" cy="90" r="4" fill="rgba(255,210,77,.9)" filter="url(#glow)"/>
              <circle cx="190" cy="130" r="3" fill="rgba(255,210,77,.75)" filter="url(#glow)"/>
              <circle cx="760" cy="110" r="4" fill="rgba(255,210,77,.85)" filter="url(#glow)"/>
              <circle cx="680" cy="160" r="3" fill="rgba(255,210,77,.75)" filter="url(#glow)"/>
              <circle cx="420" cy="95" r="3" fill="rgba(255,210,77,.75)" filter="url(#glow)"/>
            </g>

            <path d="M0,285 C140,250 300,305 420,284 C560,260 700,320 900,292 L900,420 L0,420 Z" fill="url(#ground)"/>

            <!-- Bäume -->
            <g opacity=".95">
              <g transform="translate(130,110)">
                <rect x="46" y="140" width="34" height="110" rx="10" fill="rgba(120,80,40,.55)"/>
                <circle cx="64" cy="130" r="80" fill="rgba(40,255,198,.18)" filter="url(#glow)"/>
                <circle cx="34" cy="130" r="55" fill="rgba(124,255,92,.16)"/>
                <circle cx="98" cy="126" r="58" fill="rgba(46,227,255,.12)"/>
              </g>
              <g transform="translate(690,110)">
                <rect x="46" y="140" width="34" height="110" rx="10" fill="rgba(120,80,40,.52)"/>
                <circle cx="64" cy="130" r="84" fill="rgba(255,63,169,.12)" filter="url(#glow)"/>
                <circle cx="34" cy="130" r="55" fill="rgba(124,255,92,.14)"/>
                <circle cx="102" cy="126" r="60" fill="rgba(255,210,77,.10)"/>
              </g>
            </g>

            <!-- Funkelweg -->
            <path d="M455,420 C450,350 520,340 580,320 C660,290 640,258 590,240 C540,220 470,215 410,205 C330,190 270,175 235,140"
                  fill="none" stroke="rgba(255,255,255,.16)" stroke-width="20" stroke-linecap="round"/>
            <path d="M455,420 C450,350 520,340 580,320 C660,290 640,258 590,240 C540,220 470,215 410,205 C330,190 270,175 235,140"
                  fill="none" stroke="rgba(255,210,77,.22)" stroke-width="8" stroke-linecap="round" filter="url(#glow)"/>

            <!-- Boss-Tor -->
            <g transform="translate(470,180)">
              <rect x="-110" y="-110" width="220" height="210" rx="24"
                    fill="rgba(255,255,255,.07)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
              <rect x="-85" y="-85" width="170" height="160" rx="20"
                    fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.12)"/>
              <circle cx="70" cy="-5" r="10" fill="rgba(255,210,77,.65)" filter="url(#glow)"/>
              <path d="M-60,60 Q0,20 60,60" fill="none" stroke="rgba(255,255,255,.14)" stroke-width="8" stroke-linecap="round"/>
            </g>

            <!-- Hotspots (unsichtbar, aber klickbar) -->
            <g style="cursor:pointer;">
              <rect data-hot="gate" x="360" y="70" width="240" height="260" rx="20"
                    fill="rgba(255,255,255,0)" stroke="rgba(255,255,255,0)"/>
              <rect data-hot="lock" x="520" y="150" width="120" height="150" rx="18"
                    fill="rgba(255,255,255,0)" stroke="rgba(255,255,255,0)"/>
              <rect data-hot="apple" x="720" y="140" width="120" height="140" rx="18"
                    fill="rgba(255,255,255,0)" stroke="rgba(255,255,255,0)"/>
              <rect data-hot="star" x="240" y="150" width="140" height="140" rx="18"
                    fill="rgba(255,255,255,0)" stroke="rgba(255,255,255,0)"/>
            </g>

            <rect x="12" y="12" width="876" height="396" rx="20" fill="none" stroke="rgba(255,255,255,.10)"/>
          </svg>

          <!-- FIPS (stilisiert als SVG-Figur, später ersetzbar durch PNG) -->
          <div class="fips" aria-hidden="true">
            <svg viewBox="0 0 120 140" width="120" height="140">
              <defs>
                <radialGradient id="fBody" cx="35%" cy="30%" r="70%">
                  <stop offset="0%" stop-color="rgba(255,255,255,.95)"/>
                  <stop offset="45%" stop-color="rgba(255,210,77,.88)"/>
                  <stop offset="100%" stop-color="rgba(255,63,169,.24)"/>
                </radialGradient>
                <filter id="fGlow" x="-30%" y="-30%" width="160%" height="160%">
                  <feGaussianBlur stdDeviation="5" result="b"/>
                  <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
              </defs>
              <!-- shadow -->
              <ellipse cx="60" cy="132" rx="36" ry="8" fill="rgba(0,0,0,.25)"/>
              <!-- body -->
              <path filter="url(#fGlow)" fill="url(#fBody)"
                d="M60 18
                   C82 18 96 36 96 56
                   C96 84 84 114 60 114
                   C36 114 24 84 24 56
                   C24 36 38 18 60 18 Z"/>
              <!-- belly core -->
              <circle cx="60" cy="78" r="10" fill="rgba(46,227,255,.25)" stroke="rgba(46,227,255,.30)"/>
              <circle cx="60" cy="78" r="4" fill="rgba(46,227,255,.75)" filter="url(#fGlow)"/>
              <!-- eyes -->
              <circle cx="48" cy="54" r="9" fill="rgba(0,0,0,.28)"/>
              <circle cx="48" cy="54" r="4" fill="rgba(255,255,255,.9)"/>
              <circle cx="72" cy="54" r="9" fill="rgba(0,0,0,.28)"/>
              <circle cx="72" cy="54" r="4" fill="rgba(255,255,255,.9)"/>
              <!-- smile -->
              <path d="M46,70 Q60,82 74,70" fill="none" stroke="rgba(0,0,0,.25)" stroke-width="5" stroke-linecap="round"/>
              <!-- spark hair -->
              <path d="M42,20 Q60,2 78,20" fill="none" stroke="rgba(255,210,77,.70)" stroke-width="8" stroke-linecap="round" filter="url(#fGlow)"/>
              <circle cx="60" cy="8" r="4" fill="rgba(255,210,77,.95)" filter="url(#fGlow)"/>
              <!-- arms -->
              <path d="M24,64 Q12,78 18,92" fill="none" stroke="rgba(255,210,77,.55)" stroke-width="10" stroke-linecap="round"/>
              <path d="M96,64 Q108,78 102,92" fill="none" stroke="rgba(255,210,77,.55)" stroke-width="10" stroke-linecap="round"/>
              <!-- legs -->
              <path d="M46,114 Q42,126 50,132" fill="none" stroke="rgba(255,210,77,.55)" stroke-width="10" stroke-linecap="round"/>
              <path d="M74,114 Q78,126 70,132" fill="none" stroke="rgba(255,210,77,.55)" stroke-width="10" stroke-linecap="round"/>
            </svg>
          </div>
        </div>

        <!-- QUESTLOG -->
        <div class="questlog">
          <div class="qhdr">
            <div class="title" id="qName">Questlog: Boss-Tor</div>
            <div class="tag" id="qFocus">Fokus: Ursache/Wirkung</div>
          </div>

          <div class="readText" id="readText"></div>
          <div class="question" id="question"></div>

          <div class="answers" id="answers"></div>

          <div class="controls">
            <button class="mini" id="btnRead" type="button">Nochmal lesen</button>
            <button class="mini" id="btnHelp" type="button">Hilfe</button>
            <span class="pill" style="font-size:12px;"><b>Versuche</b> <span id="tries">0</span></span>
            <span class="pill" style="font-size:12px;"><b>Geheimfunke</b> <span id="secret">0/1</span></span>
          </div>

          <div class="statusLine neutral" id="status">Tippe in die Szene oder lies den Text. Dann antworte.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reward overlay -->
  <div class="reward" id="reward">
    <div class="starWrap">
      <div class="spark"></div>
      <svg viewBox="0 0 200 200" style="position:absolute;inset:0;">
        <defs>
          <radialGradient id="gStar" cx="35%" cy="30%" r="70%">
            <stop offset="0%" stop-color="rgba(255,255,255,.95)"/>
            <stop offset="45%" stop-color="rgba(255,210,77,.92)"/>
            <stop offset="100%" stop-color="rgba(255,63,169,.28)"/>
          </radialGradient>
          <filter id="glowBig" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="6" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <path filter="url(#glowBig)" fill="url(#gStar)"
          d="M100 18 L122 70 L178 74 L134 110 L148 166 L100 136 L52 166 L66 110 L22 74 L78 70 Z"/>
      </svg>
      <div class="rewardText" id="rewardText">Stern erhalten</div>
    </div>
  </div>

<script>
(()=>{"use strict";

  /* ====== State (LocalStorage) ====== */
  const LS="osion_xr_onefile_mvp_v1";
  const base={ stars:0, streak:0, level:1, secretTotal:0 };
  const state=load();

  function load(){
    try{
      const s=JSON.parse(localStorage.getItem(LS)||"null");
      if(!s) return {...base};
      return {
        stars: Number(s.stars||0),
        streak: Number(s.streak||0),
        level: Math.max(1, Math.min(3, Number(s.level||1))),
        secretTotal: Number(s.secretTotal||0)
      };
    }catch{ return {...base}; }
  }
  function save(){ localStorage.setItem(LS, JSON.stringify(state)); }
  function reset(){ localStorage.removeItem(LS); location.reload(); }

  /* ====== Content (im Code) ====== */
  const CARD={
    quest:"Boss-Tor",
    focus:"Ursache/Wirkung",
    text:"Vor Fips ist ein großes Tor. Das Tor ist zu. Fips braucht einen Schlüssel.",
    question:"Warum geht das Tor nicht auf?",
    options:[
      {id:"a", text:"Weil das Tor zu ist.", correct:true, hintKey:"zu"},
      {id:"b", text:"Weil Fips fliegt.", correct:false},
      {id:"c", text:"Weil es regnet.", correct:false}
    ],
    help:"Ursache/Wirkung: Suche die Aussage im Text, die erklärt, was los ist."
  };

  /* ====== UI ====== */
  const $=(id)=>document.getElementById(id);
  const ui={
    kStars:$("kStars"), kStreak:$("kStreak"), kLevel:$("kLevel"), kFocus:$("kFocus"), kQuest:$("kQuest"),
    gMsg:$("gMsg"),
    readText:$("readText"), question:$("question"), answers:$("answers"),
    tries:$("tries"), secret:$("secret"),
    status:$("status"),
    btnRead:$("btnRead"), btnHelp:$("btnHelp"),
    btnReset:$("btnReset"), btnPlay:$("btnPlay"),
    scene:$("scene"), tip:$("tip"),
    reward:$("reward"), rewardText:$("rewardText")
  };

  let tries=0;
  let answered=false;
  let secretFound=false;
  let lastHint="";

  function renderKpis(){
    ui.kStars.textContent=String(state.stars);
    ui.kStreak.textContent=String(state.streak);
    ui.kLevel.textContent=String(state.level);
    ui.kFocus.textContent=CARD.focus;
    ui.kQuest.textContent=CARD.quest;
  }

  function shuffle(arr){
    const a=arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }
  function highlight(text,key){
    if(!key) return escapeHtml(text);
    const idx=text.toLowerCase().indexOf(String(key).toLowerCase());
    if(idx<0) return escapeHtml(text);
    const a=text.slice(0,idx), b=text.slice(idx,idx+key.length), c=text.slice(idx+key.length);
    return `${escapeHtml(a)}<span class="hl">${escapeHtml(b)}</span>${escapeHtml(c)}`;
  }

  function setStatus(kind, txt){
    ui.status.className="statusLine "+kind;
    ui.status.textContent=txt;
  }

  function setGuide(txt){
    ui.gMsg.textContent=txt;
  }

  function showReward(txt){
    ui.rewardText.textContent=txt;
    ui.reward.classList.add("show");
    setTimeout(()=>ui.reward.classList.remove("show"), 950);
  }

  function renderCard(){
    answered=false;
    tries=0;
    secretFound=false;
    lastHint="";

    ui.readText.innerHTML=escapeHtml(CARD.text);
    ui.question.textContent=CARD.question;

    ui.answers.innerHTML="";
    const opts=shuffle(CARD.options);
    opts.forEach(opt=>{
      const b=document.createElement("button");
      b.type="button";
      b.className="ans";
      b.textContent=opt.text;
      b.addEventListener("click", ()=>onAnswer(opt, b));
      ui.answers.appendChild(b);
    });

    ui.tries.textContent=String(tries);
    ui.secret.textContent=`${secretFound?1:0}/1`;

    setGuide("Tippe in die Szene. Dann lies das Questlog. Dann antworte.");
    setStatus("neutral","Tippe in die Szene oder lies den Text. Dann antworte.");

    renderKpis();
  }

  function adapt(correct){
    if(correct){
      state.streak += 1;
      if(state.streak >= 3){
        state.level = Math.min(3, state.level+1);
        state.streak = 0;
        setGuide("Level hoch. Du wirst stärker.");
      }
    } else {
      state.streak = 0;
    }
  }

  function onAnswer(opt, btn){
    if(answered) return;

    tries += 1;
    ui.tries.textContent=String(tries);

    if(opt.correct){
      answered=true;
      btn.classList.add("correct");

      state.stars += 1;
      adapt(true);
      save();
      renderKpis();

      showReward("Stern erhalten");
      setGuide("Richtig. Stark.");
      setStatus("good","Richtig. Du bekommst einen Stern.");

      // MVP: nach kurzer Zeit “weiter” simulieren
      setTimeout(()=>{
        setGuide("Kapitel abgeschlossen. Öffne Diagnose (kommt als nächster Schritt).");
        setStatus("good","Kapitel abgeschlossen. Für jetzt: Reset oder Play erneut.");
      }, 650);

      return;
    }

    btn.classList.add("wrong");
    adapt(false);
    save();
    renderKpis();

    setGuide("Ups. Lies nochmal. Such das Wort im Text.");
    setStatus("bad","Noch nicht. Lies nochmal. Dann antworte.");

    // ab 2 Fehlversuchen: highlight Hinweiswort
    if(tries >= 2){
      const right=CARD.options.find(o=>o.correct);
      if(right?.hintKey){
        lastHint = right.hintKey;
        ui.readText.innerHTML = highlight(CARD.text, lastHint);
        setStatus("neutral","Tipp: Das passende Wort ist im Text markiert.");
      }
    }
  }

  /* ====== Scene Hotspots ====== */
  const hotText={
    gate:"Das ist das Boss-Tor. Es wirkt schwer.",
    lock:"Das Schloss glitzert. Vielleicht brauchst du einen Schlüssel.",
    apple:"Ein Apfel? Der lenkt ab. Fokus behalten.",
    star:"Ein Sternfunke. Sammle ihn."
  };

  function showTip(x,y, txt){
    ui.tip.textContent=txt;
    ui.tip.style.left = x+"px";
    ui.tip.style.top  = y+"px";
    ui.tip.classList.add("show");
    clearTimeout(showTip._t);
    showTip._t=setTimeout(()=>ui.tip.classList.remove("show"), 1200);
  }

  // Klick-Handling in SVG Hotspots
  ui.scene.addEventListener("click",(e)=>{
    const t=e.target;
    const hot=t && t.getAttribute && t.getAttribute("data-hot");
    if(!hot) return;

    const rect=ui.scene.getBoundingClientRect();
    const x = (e.clientX - rect.left) + 12;
    const y = (e.clientY - rect.top) - 6;

    showTip(x,y, hotText[hot] || "Entdeckt.");

    // Geheimfunke: erster Hotspot-Klick pro Karte
    if(!secretFound){
      secretFound=true;
      state.secretTotal += 1;
      save();
      ui.secret.textContent=`1/1`;
      setGuide("Geheimfunke gefunden. Jetzt Quest lösen.");
      setStatus("good","Geheimfunke eingesammelt. Jetzt lesen und antworten.");
      spawnParticles(rect, e.clientX-rect.left, e.clientY-rect.top);
    }
  });

  function spawnParticles(rect, sx, sy){
    // kleine Funken an der Klickstelle (CSS)
    for(let i=0;i<10;i++){
      const p=document.createElement("div");
      p.className="particle";
      const dx = (Math.random()*18-9);
      const dy = (Math.random()*10-5);
      p.style.left = (sx+dx)+"px";
      p.style.top  = (sy+dy)+"px";
      p.style.animationDelay = (Math.random()*0.15)+"s";
      p.style.background = `rgba(255,210,77,${0.55+Math.random()*0.35})`;
      ui.scene.appendChild(p);
      setTimeout(()=>p.remove(), 1600);
    }
  }

  /* ====== Controls ====== */
  ui.btnRead.addEventListener("click", ()=>{
    ui.readText.innerHTML = lastHint ? highlight(CARD.text,lastHint) : escapeHtml(CARD.text);
    setStatus("neutral","Nochmal lesen. Dann antworten.");
  });
  ui.btnHelp.addEventListener("click", ()=>{
    const right=CARD.options.find(o=>o.correct);
    if(right?.hintKey){
      lastHint = right.hintKey;
      ui.readText.innerHTML = highlight(CARD.text,lastHint);
    }
    setGuide(CARD.help);
    setStatus("neutral","Hilfe aktiv. Lies den markierten Teil.");
  });

  ui.btnReset.addEventListener("click", reset);
  ui.btnPlay.addEventListener("click", renderCard);

  renderCard();
})();
</script>
</body>
</html>
